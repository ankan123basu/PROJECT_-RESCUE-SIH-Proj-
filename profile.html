<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agency Profile - Rescue Agency Coordination System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            200: '#bae6fd',
                            300: '#7dd3fc',
                            400: '#38bdf8',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1',
                            800: '#075985',
                            900: '#0c4a6e',
                        },
                    },
                },
            },
        }
    </script>
    
    <style>
        /* Glass morphism effects */
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .glass-effect-dark {
            background: rgba(0, 0, 0, 0.4);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        
        /* Glossy button effects */
        .glossy-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .glossy-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            transition: all 0.6s ease;
        }
        
        .glossy-btn:hover::before {
            left: 100%;
        }
        
        /* Navigation backdrop */
        .nav-backdrop {
            background: rgba(0, 0, 0, 0.4);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Progress bars */
        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background-color: rgba(55, 65, 81, 1);
            border-radius: 0.25rem;
            margin-top: 0.5rem;
        }
        
        .progress-bar-fill {
            height: 100%;
            border-radius: 0.25rem;
            transition: width 0.5s ease;
        }
        
        .progress-bar-fill.success { background-color: #34c759; }
        .progress-bar-fill.warning { background-color: #ffc107; }
        .progress-bar-fill.danger { background-color: #f44336; }
        .progress-bar-fill.info { background-color: #0ea5e9; }
        
        /* Width classes for progress bars */
        .w-0 { width: 0%; }
        .w-25 { width: 25%; }
        .w-50 { width: 50%; }
        .w-65 { width: 65%; }
        .w-75 { width: 75%; }
        .w-80 { width: 80%; }
        .w-90 { width: 90%; }
        .w-92 { width: 92%; }
        .w-95 { width: 95%; }
        .w-100 { width: 100%; }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white font-sans min-h-screen">
    <!-- Navigation -->
    <nav class="nav-backdrop sticky top-0 z-50">
        <div class="mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <span class="text-xl font-bold text-white">RESCUE</span>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="dashboard.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-200">Dashboard</a>
                            <a href="agency-network.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-200">Agency Network</a>
                            <a href="emergency-coordination.html" class="px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white transition-all duration-200">Emergency Coordination</a>
                            <a href="profile.html" class="px-3 py-2 rounded-md text-sm font-medium bg-blue-600 text-white">Profile</a>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button class="glossy-btn rounded-full p-1 text-gray-300 hover:text-white focus:outline-none">
                            <span class="sr-only">View notifications</span>
                            <i class="fas fa-bell text-xl"></i>
                            <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500 animate-pulse"></span>
                        </button>
                    </div>
                    <div class="relative">
                        <button id="user-menu-button" class="glossy-btn flex items-center rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 p-1 text-white focus:outline-none">
                            <span class="sr-only">Open user menu</span>
                            <i class="fas fa-user-circle text-xl"></i>
                        </button>
                        <!-- User dropdown menu -->
                        <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 glass-effect-dark ring-1 ring-black ring-opacity-5 focus:outline-none z-50">
                            <a href="profile.html" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">Your Profile</a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">Settings</a>
                            <a href="php/logout.php" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">Sign out</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-1 py-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-bold text-white mb-8">Agency Profile</h1>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Profile Information -->
                <div class="col-span-2">
                    <div class="glass-effect rounded-lg p-6 mb-6">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-user-circle mr-2"></i>
                            Agency Information
                        </h2>
                        <form id="profile-form" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="agency-name" class="block text-sm font-medium text-gray-300 mb-1">Agency Name</label>
                                    <input type="text" id="agency-name" name="agency-name" class="w-full rounded-lg bg-gray-800 border-gray-700 text-white px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="agency-type" class="block text-sm font-medium text-gray-300 mb-1">Agency Type</label>
                                    <select id="agency-type" name="agency-type" title="Select agency type" class="w-full rounded-lg bg-gray-800 border-gray-700 text-white px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                        <option value="ambulance">Ambulance</option>
                                        <option value="fire">Fire Department</option>
                                        <option value="police">Police</option>
                                        <option value="hospital">Hospital</option>
                                        <option value="rescue">Rescue Team</option>
                                        <option value="ngo">NGO</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="email" class="block text-sm font-medium text-gray-300 mb-1">Email</label>
                                    <input type="email" id="email" name="email" class="w-full rounded-lg bg-gray-800 border-gray-700 text-white px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="phone" class="block text-sm font-medium text-gray-300 mb-1">Phone</label>
                                    <input type="tel" id="phone" name="phone" class="w-full rounded-lg bg-gray-800 border-gray-700 text-white px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div class="md:col-span-2">
                                    <label for="address" class="block text-sm font-medium text-gray-300 mb-1">Address</label>
                                    <input type="text" id="address" name="address" class="w-full rounded-lg bg-gray-800 border-gray-700 text-white px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>
                            
                            <div>
                                <label for="status" class="block text-sm font-medium text-gray-300 mb-1">Operational Status</label>
                                <select id="status" name="status" title="Select operational status" class="w-full rounded-lg bg-gray-800 border-gray-700 text-white px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="available">Available</option>
                                    <option value="busy">Busy</option>
                                    <option value="offline">Offline</option>
                                    <option value="emergency">Responding to Emergency</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Available Resources</label>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    <div class="flex items-center">
                                        <input type="checkbox" id="resource-ambulance" name="resources[]" value="ambulance" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label for="resource-ambulance" class="ml-2 block text-sm text-gray-300">Ambulances</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="resource-fire-truck" name="resources[]" value="fire-truck" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label for="resource-fire-truck" class="ml-2 block text-sm text-gray-300">Fire Trucks</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="resource-medical" name="resources[]" value="medical" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label for="resource-medical" class="ml-2 block text-sm text-gray-300">Medical Supplies</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="resource-personnel" name="resources[]" value="personnel" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label for="resource-personnel" class="ml-2 block text-sm text-gray-300">Personnel</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="resource-shelter" name="resources[]" value="shelter" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label for="resource-shelter" class="ml-2 block text-sm text-gray-300">Shelter</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="resource-food" name="resources[]" value="food" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label for="resource-food" class="ml-2 block text-sm text-gray-300">Food & Water</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end">
                                <button type="submit" class="glossy-btn bg-gradient-to-r from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 text-white px-6 py-2 rounded-lg shadow-lg transition-all duration-300">
                                    Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="glass-effect rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-lock mr-2"></i>
                            Security
                        </h2>
                        <form id="password-form" class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="current-password" class="block text-sm font-medium text-gray-300 mb-1">Current Password</label>
                                    <input type="password" id="current-password" name="current-password" class="w-full rounded-lg bg-gray-800 border-gray-700 text-white px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div class="md:col-span-2 border-t border-gray-700 pt-4"></div>
                                <div>
                                    <label for="new-password" class="block text-sm font-medium text-gray-300 mb-1">New Password</label>
                                    <input type="password" id="new-password" name="new-password" class="w-full rounded-lg bg-gray-800 border-gray-700 text-white px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="confirm-password" class="block text-sm font-medium text-gray-300 mb-1">Confirm New Password</label>
                                    <input type="password" id="confirm-password" name="confirm-password" class="w-full rounded-lg bg-gray-800 border-gray-700 text-white px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>
                            
                            <div class="flex justify-end">
                                <button type="submit" class="glossy-btn bg-gradient-to-r from-blue-500 to-blue-700 hover:from-blue-600 hover:to-blue-800 text-white px-6 py-2 rounded-lg shadow-lg transition-all duration-300">
                                    Update Password
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Status Card and Stats -->
                <div class="col-span-1">
                    <div class="glass-effect rounded-lg p-6 mb-6">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-line mr-2"></i>
                            Agency Status
                        </h2>
                        <div class="flex flex-col items-center mb-6">
                            <div class="w-32 h-32 rounded-full bg-gradient-to-r from-green-500 to-green-700 flex items-center justify-center mb-4" id="status-indicator">
                                <i class="fas fa-check text-4xl"></i>
                            </div>
                            <div class="text-2xl font-bold" id="status-text">Available</div>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Response Rate</span>
                                    <span class="font-medium">92%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-bar-fill success w-92"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Resource Utilization</span>
                                    <span class="font-medium">78%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-bar-fill warning w-75"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Network Connections</span>
                                    <span class="font-medium">65%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-bar-fill info w-65"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-effect rounded-lg p-6">
                        <h2 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-bell mr-2"></i>
                            Recent Notifications
                        </h2>
                        <div class="space-y-4">
                            <div class="flex items-start space-x-3 p-3 rounded-lg bg-gray-800 bg-opacity-50">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-red-500 flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium">Emergency Alert</p>
                                    <p class="text-xs text-gray-400">Flooding reported in downtown area</p>
                                    <p class="text-xs text-gray-500 mt-1">2 hours ago</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3 p-3 rounded-lg bg-gray-800 bg-opacity-50">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center">
                                    <i class="fas fa-user-plus text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium">Connection Request</p>
                                    <p class="text-xs text-gray-400">City Hospital wants to connect</p>
                                    <p class="text-xs text-gray-500 mt-1">Yesterday</p>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3 p-3 rounded-lg bg-gray-800 bg-opacity-50">
                                <div class="flex-shrink-0 w-8 h-8 rounded-full bg-green-500 flex items-center justify-center">
                                    <i class="fas fa-check text-sm"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium">Status Update</p>
                                    <p class="text-xs text-gray-400">Your resources have been updated</p>
                                    <p class="text-xs text-gray-500 mt-1">2 days ago</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Toggle user dropdown
        document.getElementById('user-menu-button').addEventListener('click', function() {
            const dropdown = document.getElementById('user-dropdown');
            dropdown.classList.toggle('hidden');
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('user-dropdown');
            const button = document.getElementById('user-menu-button');
            if (!dropdown.contains(event.target) && !button.contains(event.target)) {
                dropdown.classList.add('hidden');
            }
        });
        
        // Fetch agency profile data
        document.addEventListener('DOMContentLoaded', function() {
            fetch('php/get_profile.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Populate form fields
                        document.getElementById('agency-name').value = data.agency.name;
                        document.getElementById('agency-type').value = data.agency.type;
                        document.getElementById('email').value = data.agency.email;
                        document.getElementById('phone').value = data.agency.phone;
                        document.getElementById('address').value = data.agency.address;
                        document.getElementById('status').value = data.agency.status;
                        
                        // Update status indicator
                        updateStatusIndicator(data.agency.status);
                        
                        // Check resources
                        if (data.agency.resources && Array.isArray(data.agency.resources)) {
                            data.agency.resources.forEach(resource => {
                                const checkbox = document.querySelector(`input[value="${resource}"]`);
                                if (checkbox) checkbox.checked = true;
                            });
                        }
                    } else {
                        console.error('Error loading profile:', data.error);
                    }
                })
                .catch(error => console.error('Error:', error));
        });
        
        // Update status indicator based on status
        function updateStatusIndicator(status) {
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            
            // Remove existing classes
            indicator.className = 'w-32 h-32 rounded-full flex items-center justify-center mb-4';
            
            // Add appropriate classes based on status
            switch(status) {
                case 'available':
                    indicator.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-700');
                    indicator.innerHTML = '<i class="fas fa-check text-4xl"></i>';
                    statusText.textContent = 'Available';
                    break;
                case 'busy':
                    indicator.classList.add('bg-gradient-to-r', 'from-yellow-500', 'to-yellow-700');
                    indicator.innerHTML = '<i class="fas fa-clock text-4xl"></i>';
                    statusText.textContent = 'Busy';
                    break;
                case 'offline':
                    indicator.classList.add('bg-gradient-to-r', 'from-gray-500', 'to-gray-700');
                    indicator.innerHTML = '<i class="fas fa-power-off text-4xl"></i>';
                    statusText.textContent = 'Offline';
                    break;
                case 'emergency':
                    indicator.classList.add('bg-gradient-to-r', 'from-red-500', 'to-red-700');
                    indicator.innerHTML = '<i class="fas fa-exclamation-triangle text-4xl"></i>';
                    statusText.textContent = 'Responding to Emergency';
                    break;
                default:
                    indicator.classList.add('bg-gradient-to-r', 'from-blue-500', 'to-blue-700');
                    indicator.innerHTML = '<i class="fas fa-question text-4xl"></i>';
                    statusText.textContent = 'Unknown';
            }
        }
        
        // Handle status change
        document.getElementById('status').addEventListener('change', function() {
            updateStatusIndicator(this.value);
        });
        
        // Handle profile form submission
        document.getElementById('profile-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = new FormData(this);
            
            // Submit form data
            fetch('php/update_profile.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Profile updated successfully!');
                } else {
                    alert('Error updating profile: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while updating your profile.');
            });
        });
        
        // Handle password form submission
        document.getElementById('password-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get form data
            const formData = new FormData(this);
            
            // Validate passwords match
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match!');
                return;
            }
            
            // Submit form data
            fetch('php/update_password.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Password updated successfully!');
                    this.reset();
                } else {
                    alert('Error updating password: ' + data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while updating your password.');
            });
        });
    </script>
</body>
</html>
